
set -e

#if is windows then use pip to install uv, else use pip3
if [[ "$OSTYPE" == "msys" ]]; then
  pip install uv --break-system-packages
else
  pip3 install uv --break-system-packages
fi

uv venv --python 3.11

# if requirements.testing.txt exists then install it
if [[ -f requirements.testing.txt ]]; then
  uv run pip install -r requirements.testing.txt
fi

uv run pip install -e .

rm -rf ./activate

# if windows then symlink .venv/Scripts/activate to .venv/bin/activate
if [[ "$OSTYPE" == "msys" ]]; then
  ln -s .venv/Scripts/activate ./activate
  if [[ -d .git ]]; then
    git add ./activate --chmod=+x
  fi
else
  ln -s .venv/bin/activate ./activate
fi
